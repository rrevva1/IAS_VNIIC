# Раздел 3. Реализация и тестирование прототипа информационно-аналитической системы учёта технических средств предприятия

Документ подготовлен в соответствии с планом ВКР по теме «Проектирование и разработка прототипа информационно-аналитической системы учёта технических средств предприятия». Раздел охватывает подпункты 3.1–3.4 плана работы и предназначен для включения в третью главу выпускной квалификационной работы.

**Важно.** В местах, требующих демонстрации (скриншоты, листинги кода, демонстрация работающей программы), в тексте приведены явные указания: *что* вставить и *куда* (в какой подраздел, под какой подписью). При оформлении ВКР эти вставки выполняются автором: делаются скриншоты работающего приложения, копируются фрагменты кода из репозитория, при необходимости проводится демонстрация на защите.

---

## 3.1. Обоснование выбора технологий и средств реализации

Выбор стека технологий выполнен на основе требований к учёту активов, заявкам, вложениям, импорту и интеграции со справочниками и существующим фронтендом (разделы 1.5 и 2).

### 3.1.1. Серверная часть: PHP, фреймворк Yii2

**PHP** обеспечивает выполнение серверной логики в среде веб-сервера, совместимость с типовой инфраструктурой предприятия (Apache/nginx, PHP-FPM) и быструю разработку прототипа без смены уже используемого на предприятии стека.

**Фреймворк Yii2** выбран по следующим причинам:

- структура MVC (модели, контроллеры, представления) упорядочивает код и разделение ответственности;
- встроенная поддержка RBAC (роли и разрешения) и компонент AccessControl в контроллерах позволяют централизованно задавать правила доступа к действиям;
- ActiveRecord обеспечивает работу с БД (выборки, сохранение, связи) без написания сырого SQL в типовых сценариях;
- поддержка валидации форм, загрузки файлов (UploadedFile), ответов в JSON и фильтров (VerbFilter) покрывает потребности контуров Help Desk, активов и вложений;
- наличие механизма миграций БД упрощает сопровождение схемы при изменениях.

### 3.1.2. СУБД: PostgreSQL

**PostgreSQL** обеспечивает:

- надёжное хранение данных с поддержкой транзакций и ссылочной целостности (внешние ключи);
- кодировку UTF-8 для хранения русскоязычных данных и наименований;
- типы TIMESTAMPTZ для единообразного учёта времени, JSONB для метаданных и полей истории;
- возможность реализации триггеров (например, запрет UPDATE/DELETE для таблицы журнала аудита);
- индексацию по ключевым полям для достижения целевых показателей производительности (время формирования списков заявок и активов).

База данных прототипа: `ias_vniic`, схема `tech_accounting` (в соответствии с разделом 2.3).

### 3.1.3. Веб-клиент и AG Grid

Веб-интерфейс реализован в рамках того же приложения (Yii2 views): страницы рендерятся на сервере, табличные данные подгружаются по AJAX в формате JSON. Для отображения списков заявок, активов, пользователей и журнала аудита используется компонент **AG Grid** (или аналог табличного представления), что соответствует требованию к интеграции с существующим фронтендом и к совместимости с табличными представлениями (раздел 2.1). Данные для грида отдаются эндпоинтами вида `get-grid-data` (контроллеры TasksController, ArmController, UsersController, AuditController).

### 3.1.4. Средства развёртывания и кодировка

Развёртывание выполняется на типовом веб-сервере (Apache или nginx с PHP-FPM) с настроенным виртуальным хостом на корень приложения; СУБД PostgreSQL устанавливается отдельно. Конфигурация приложения (подключение к БД, параметры пользователя) выносится в конфигурационные файлы (например, `config/db.php`, переменные окружения), без хранения учётных данных БД в коде. Кодировка данных: **UTF-8** на всех уровнях (БД, соединение с БД, заголовки HTTP, содержимое страниц и JSON), что обеспечивает корректное отображение кириллицы в интерфейсе и отчётах.

**Вставка в ВКР (по желанию).** При необходимости можно добавить **листинг конфигурации** подключения к БД или фрагмент `composer.json` с основными зависимостями (yii2, php, расширения для PostgreSQL). Рекомендуемое место: после п. 3.1.4, под подписью вида «Листинг 1 — фрагмент конфигурации подключения к БД (config/db.php)» или «Листинг 1 — фрагмент composer.json».

---

## 3.2. Реализация ключевых модулей прототипа

Реализация модулей выполнена в кодовой базе приложения (каталог `ias_uch_vnii`). Ниже указаны соответствующие контроллеры, модели и компоненты; в местах, уместных для иллюстрации кода в ВКР, даны указания на вставку листингов.

### 3.2.1. Модуль ведения карточек активов и характеристик

**Реализация.** Контроллер `ArmController` (файл `ias_uch_vnii/controllers/ArmController.php`): действия `index` (страница списка с AG Grid), `get-grid-data` (JSON для грида), `view` (карточка актива), `update` (создание/редактирование), `archive` (архивирование). Модели: `Equipment`, `EquipHistory`, `PartCharValues`, `SprParts`, `SprChars`, `Location`, `DicEquipmentStatus`; модель поиска `ArmSearch` для фильтрации. Доступ к списку, созданию и архивированию — только для администратора; к просмотру и редактированию карточки — администратор или ответственный за актив (matchCallback).

**Вставка в ВКР.** После описания модуля можно разместить **Листинг 2** — фрагмент `ArmController`: объявление класса, метод `behaviors()` (правила доступа AccessControl) и один из методов, например `actionIndex()` или `actionGetGridData()`. Подпись: «Листинг 2 — фрагмент ArmController: правила доступа и действие списка ТС (ias_uch_vnii/controllers/ArmController.php)».

### 3.2.2. Модуль регистрации и сопровождения заявок (статусы, исполнители, комментарии)

**Реализация.** Контроллер `TasksController` (`ias_uch_vnii/controllers/TasksController.php`): действия `index` (список заявок), `view` (детали заявки), `create` (создание), `get-grid-data` (данные для грида), `change-status`, `assign-executor`, `update-comment`. Проверка доступа к заявке — метод `canUserAccessTask($model)` (автор, исполнитель, оператор, администратор). Модели: `Tasks`, `TaskHistory`, `DicTaskStatus`, `Users`; модель поиска `TasksSearch`.

**Вставка в ВКР.** После описания модуля можно разместить **Листинг 3** — фрагмент `TasksController`: метод `canUserAccessTask()` и одно из действий изменения состояния (например, `actionChangeStatus()` или `actionAssignExecutor()`). Подпись: «Листинг 3 — фрагмент TasksController: проверка доступа к заявке и смена статуса (ias_uch_vnii/controllers/TasksController.php)».

### 3.2.3. Модуль работы с вложениями и связи заявок с активами

**Реализация.** Вложения: модели `DeskAttachments`, `TaskAttachments`; в `TasksController` — загрузка файлов при создании/редактировании заявки, действия `download` и `preview` с проверкой доступа к заявке, при необходимости — заголовок X-Content-Type-Options: nosniff и ограничения на предпросмотр по типу файла. Связь заявка — актив: таблица `task_equipment`, отображение в форме заявки и в карточке актива.

**Вставка в ВКР.** При необходимости — **Листинг 4** — фрагмент кода сохранения вложения и проверки прав при скачивании (например, фрагмент действия `actionDownload` в TasksController). Подпись: «Листинг 4 — фрагмент обработки вложений заявки (ias_uch_vnii/controllers/TasksController.php)».

### 3.2.4. Модуль формирования карточки пользователя и выборок по активам

**Реализация.** Перечень техники пользователя отдаётся эндпоинтом `tasks/get-user-equipment?userId=...` (действие в TasksController): выборка активов по полю ответственного (equipment.responsible_user_id). Доступ: только для текущего пользователя (свой userId) или для администратора/оператора (любой userId). Данные используются в интерфейсе деталей заявки и при выборе активов для привязки к заявке.

**Вставка в ВКР.** Листинг по этому модулю можно не включать или добавить краткий фрагмент метода `actionGetUserEquipment()` под подписью «Листинг 5 — получение перечня техники пользователя».

### 3.2.5. Модуль импорта данных и формирования протокола

**Реализация.** Контроллер `ImportController` (`ias_uch_vnii/controllers/ImportController.php`): загрузка файлов импорта (CSV, JSON, XML, XLSX — по реализованному функционалу), разбор и сопоставление полей, вставка/обновление записей. Итоги загрузки и ошибки фиксируются в таблицах `import_runs` и `import_errors` (или аналог) для формирования протокола импорта. Доступ — только администратор.

**Вставка в ВКР.** При наличии реализованного импорта — **Листинг 6** — фрагмент обработки файла импорта и записи протокола (ImportController или сервис импорта). Подпись: «Листинг 6 — фрагмент модуля импорта и протокола (ias_uch_vnii/controllers/ImportController.php)».

### 3.2.6. Модуль отчётности и экспорта

**Реализация.** Формирование отчётов и выгрузка в Excel (или иные форматы) реализованы в приложении (например, в TasksController используются PhpSpreadsheet для экспорта). Отдельные страницы/действия для отчётов по заявкам, по активам, по пользователям — в соответствии с реализованным функционалом (TasksController, ArmController, ReferencesController, отдельные экшены для отчётов). Данные формируются с учётом прав доступа.

**Вставка в ВКР.** При необходимости — **Листинг 7** — короткий фрагмент формирования отчёта (например, экспорт списка заявок в XLSX). Подпись: «Листинг 7 — фрагмент формирования отчёта (экспорт в Excel)».

### 3.2.7. Обеспечение аудита ключевых операций

**Реализация.** Компонент `AuditLog` (`ias_uch_vnii/components/AuditLog.php`): статический метод `log()` записывает в таблицу `audit_events` атрибуты события (actor_id, action_type, object_type, object_id, result_status, source_ip, user_agent, payload, error_message). Вызовы AuditLog::log() выполняются в контроллерах при операциях удаления заявки, смены статуса, назначения исполнителя, изменения карточек активов, операциях с вложениями, управлении пользователями. Неизменяемость записей журнала при необходимости обеспечивается триггером в БД (раздел 2.3).

**Вставка в ВКР.** Рекомендуется **Листинг 8** — полный или сокращённый код класса `AuditLog` (метод `log()` и параметры). Подпись: «Листинг 8 — компонент записи в журнал аудита (ias_uch_vnii/components/AuditLog.php)». Разместить после п. 3.2.7.

---

## 3.3. Демонстрация работоспособности прототипа

В данном подразделе приводятся указания по представлению скриншотов интерфейсов, примеров входных и выходных данных, а также по проведению демонстрации работающей программы (в том числе на защите ВКР). Автор при оформлении ВКР выполняет съёмку экрана или делает скриншоты по приведённым сценариям и вставляет изображения в документ в указанные места.

### 3.3.1. Список и карточка актива

**Что вставить в ВКР.**

- **Рисунок (скриншот) 1.** Список активов (учёт ТС): страница с AG Grid, на которой отображаются колонки (например, инв. номер, наименование, локация, ответственный, статус). Подпись: «Рисунок X — Экран списка учёта технических средств (AG Grid)».

- **Рисунок (скриншот) 2.** Карточка актива: страница просмотра одной единицы техники с полями (тип, инв. номер, серийный номер, марка/модель, локация, ответственный, даты, статус, при наличии — блок характеристик и история событий). Подпись: «Рисунок X — Карточка актива (просмотр)».

**Демонстрация на работающей программе.** Запустить приложение, войти под учётной записью с ролью администратора. Перейти в раздел «Учёт ТС» (или аналог по меню). Показать список активов в гриде, затем открыть карточку выбранного актива (клик по строке или кнопка «Просмотр»). При защите ВКР можно ограничиться этим сценарием или дополнительно показать создание/редактирование карточки и архивирование.

### 3.3.2. Карточка пользователя (закреплённое оборудование)

**Что вставить в ВКР.**

- **Рисунок (скриншот) 3.** Карточка пользователя: экран или панель с перечнем активов, закреплённых за выбранным пользователем (с группировкой по типу техники или в виде списка). Подпись: «Рисунок X — Карточка пользователя: закреплённое оборудование».

**Демонстрация на работающей программе.** Войти под пользователем или оператором/администратором. Открыть раздел пользователей или детали заявки, где отображается перечень техники пользователя (get-user-equipment). Показать, что отображается список техники, привязанной к выбранному пользователю.

### 3.3.3. Список заявок и детали заявки с вложениями

**Что вставить в ВКР.**

- **Рисунок (скриншот) 4.** Список заявок: страница с AG Grid (колонки: идентификатор, описание, статус, автор, исполнитель, даты). Подпись: «Рисунок X — Экран списка заявок Help Desk».

- **Рисунок (скриншот) 5.** Детали заявки: страница просмотра одной заявки с полным описанием, статусом, автором, исполнителем, списком связанных активов, блоком комментариев и списком вложений с возможностью скачивания. Подпись: «Рисунок X — Детали заявки с вложениями и связанными активами».

**Демонстрация на работающей программе.** Перейти в раздел «Заявки» (Help Desk). Показать список заявок в гриде. Открыть одну заявку (просмотр). Показать смену статуса и назначение исполнителя (кнопки/формы на странице деталей). Показать загрузку вложения и отображение списка вложений с скачиванием или предпросмотром.

### 3.3.4. Назначение исполнителя и смена статуса

**Что вставить в ВКР.**

- **Рисунок (скриншот) 6.** Фрагмент интерфейса смены статуса заявки и назначения исполнителя: выпадающий список статусов, выбор исполнителя из списка пользователей, кнопка сохранения. Можно объединить со скриншотом деталей заявки (рис. 5), если элементы управления видны на одном экране. Подпись: «Рисунок X — Назначение исполнителя и смена статуса заявки».

**Демонстрация на работающей программе.** На странице деталей заявки выбрать новый статус из списка и нажать сохранение; затем назначить исполнителя и сохранить. Показать, что после обновления страницы отображаются обновлённые статус и исполнитель. При наличии истории заявки — показать запись об изменении.

### 3.3.5. Поиск и фильтрация по активам и заявкам

**Что вставить в ВКР.**

- **Рисунок (скриншот) 7.** Экран списка активов или заявок с включёнными фильтрами (например, фильтр по статусу, по локации, по периоду) и/или с введённой строкой поиска. Результат выборки виден в таблице. Подпись: «Рисунок X — Поиск и фильтрация по активам (или заявкам)».

**Демонстрация на работающей программе.** В списке активов задать фильтр по локации или статусу; в списке заявок — по статусу и периоду. Показать, что состав строк в гриде изменился в соответствии с фильтром. При наличии текстового поиска — ввести значение и показать отфильтрованный результат.

### 3.3.6. Отчёты и экспорт

**Что вставить в ВКР.**

- **Рисунок (скриншот) 8.** Страница отчёта или результат экспорта: таблица или открытый файл Excel (или PDF) с данными по заявкам/активам в соответствии с выбранным отчётом. Подпись: «Рисунок X — Отчёт по заявкам (или экспорт в Excel)».

**Демонстрация на работающей программе.** Перейти в раздел отчётности (или статистики). Выбрать тип отчёта и параметры (период и т.д.), сформировать отчёт. Показать экспорт в файл и открытие файла с корректными данными.

### 3.3.7. Журнал аудита

**Что вставить в ВКР.**

- **Рисунок (скриншот) 9.** Страница журнала аудита: табличное представление (AG Grid) с записями (дата/время, пользователь, тип операции, объект, результат). Подпись: «Рисунок X — Журнал аудита».

**Демонстрация на работающей программе.** Войти под администратором. Открыть раздел «Журнал аудита». Выполнить в другом разделе действие, фиксируемое в аудите (например, смена статуса заявки или редактирование карточки актива). Обновить страницу журнала аудита и показать появление новой записи с соответствующим типом операции и объектом.

### 3.3.8. Примеры входных и выходных данных

**Что вставить в ВКР.** В подразделе 3.3.8 (или в приложении) целесообразно привести:

- **Пример входных данных:** фрагмент файла импорта (например, несколько строк CSV с активами или заявками) или пример заполненной формы создания заявки/актива (можно в виде таблицы: поле — значение).
- **Пример выходных данных:** фрагмент сформированного отчёта (таблица) или экспортированного файла (несколько строк), а также пример записи из журнала аудита (атрибуты: время, пользователь, тип операции, объект, результат).

Подписи: «Таблица X — Пример входных данных для импорта активов»; «Таблица X — Пример фрагмента отчёта по заявкам»; «Таблица X — Пример записи журнала аудита».

---

## 3.4. Тестирование работоспособности прототипа

Тестирование направлено на проверку корректности реализации функциональных требований (раздел 1.5), разграничения доступа, импорта, отчётности и аудита, а также на оценку производительности и устойчивости при заданных объёмах данных.

### 3.4.1. Перечень проверяемых сценариев

В таблице 1 приведён перечень сценариев тестирования. Для каждого сценария указывается цель проверки и ожидаемый результат. При оформлении ВКР в документ можно включить таблицу с результатами тестирования (например, колонка «Результат: пройден / не пройден / замечание») или краткое описание проведённых проверок.

**Таблица 1 — Сценарии тестирования прототипа**

| № | Область | Сценарий | Ожидаемый результат |
|---|---------|----------|---------------------|
| 1 | Карточки активов | Создание карточки актива с обязательными полями и характеристиками | Запись создаётся в БД, отображается в списке и в карточке просмотра |
| 2 | Карточки активов | Редактирование карточки актива (локация, ответственный, статус) | Изменения сохраняются; при наличии — запись в истории событий актива и в журнале аудита |
| 3 | Карточки активов | Архивирование актива | Актив помечается как архивированный, исключается из актуального списка (или отображается с пометкой), история сохраняется |
| 4 | Карточки пользователей | Просмотр перечня техники пользователя (get-user-equipment) | Отображаются только активы с данным ответственным; пользователь видит только свою технику; оператор/админ — по запросу любого userId |
| 5 | Заявки | Регистрация заявки с описанием и привязкой к активу | Заявка создаётся, отображается в списке и в деталях; связь заявка — актив отображается в карточке актива и в заявке |
| 6 | Заявки | Смена статуса и назначение исполнителя | Статус и исполнитель обновляются; при наличии — запись в истории заявки и в журнале аудита |
| 7 | Заявки | Добавление комментария и вложения | Комментарий и метаданные вложения сохраняются; файл доступен для скачивания в пределах прав доступа к заявке |
| 8 | Вложения | Скачивание вложения при наличии доступа к заявке | Файл скачивается; при отсутствии доступа — отказ (403) |
| 9 | Разграничение доступа | Доступ к списку активов и к карточке не-ответственного актива | Только администратор видит список; карточку актива видит администратор или ответственный за актив |
| 10 | Разграничение доступа | Видимость заявок: пользователь — только свои и где исполнитель; оператор/админ — все | Соответствие правилам по ролям |
| 11 | Импорт | Загрузка файла импорта (CSV/JSON и т.д.) и формирование протокола | Записи создаются/обновляются по правилам; протокол содержит количество обработанных и ошибок, при необходимости — перечень ошибок |
| 12 | Отчётность и экспорт | Формирование отчёта и экспорт в согласованном формате | Отчёт формируется с учётом прав доступа; файл экспорта содержит ожидаемые данные |
| 13 | Аудит | Выполнение операции, фиксируемой в аудите (смена статуса, редактирование актива) | В журнале аудита появляется запись с корректными атрибутами (время, пользователь, тип операции, объект, результат) |
| 14 | Производительность | Формирование списка заявок (с фильтрами) при заданном объёме данных | Время ответа в пределах установленных требований (например, не более 3 с для 95-го перцентиля по ПМИ) |
| 15 | Производительность | Формирование списка активов (с фильтрами) при заданном объёме данных | Аналогично п. 14 |

**Вставка в ВКР.** Таблицу 1 разместить в подразделе 3.4.1. После проведения тестирования добавить в документ **таблицу результатов тестирования**: та же структура сценариев с колонкой «Результат» (пройден / не пройден) и при необходимости «Примечание». Разместить после таблицы 1 или в подразделе 3.4.2. Подпись: «Таблица 2 — Результаты тестирования прототипа».

### 3.4.2. Краткое описание результатов тестирования

В данном подразделе автор ВКР кратко описывает, как проводилось тестирование (ручные проверки по сценариям таблицы 1, при наличии — автоматизированные тесты или нагрузочные проверки), и формулирует выводы: какие сценарии пройдены успешно, какие замечания выявлены и при необходимости как они учтены. Упоминаются проверки разграничения доступа по ролям, фиксации событий в журнале аудита, формирования протокола импорта и отчётов. При наличии требований к производительности (ПМИ) указывается соответствие или расхождение с целевыми показателями.

**Вставка в ВКР.** Текст с выводами по тестированию разместить в п. 3.4.2. При проведении **демонстрации на защите** можно опереться на сценарии из п. 3.3: показать работающее приложение — список и карточку актива, список и детали заявки со сменой статуса и назначением исполнителя, журнал аудита — и устно указать, что перечисленные сценарии тестирования выполнены с положительным результатом.

---

## Сводка: что и куда вставить в ВКР (памятка)

| Тип вставки | Где в разделе 3 | Содержание |
|-------------|------------------|------------|
| **Листинг 1** | После 3.1.4 | Конфигурация БД (config/db.php) или фрагмент composer.json |
| **Листинг 2** | После 3.2.1 | ArmController: behaviors(), actionIndex() или get-grid-data |
| **Листинг 3** | После 3.2.2 | TasksController: canUserAccessTask(), actionChangeStatus() или assign-executor |
| **Листинг 4** | После 3.2.3 | Обработка вложений (actionDownload и т.п.) |
| **Листинг 5** | По желанию | actionGetUserEquipment() |
| **Листинг 6** | После 3.2.5 | Фрагмент ImportController |
| **Листинг 7** | По желанию | Формирование отчёта / экспорт Excel |
| **Листинг 8** | После 3.2.7 | Класс AuditLog (components/AuditLog.php) |
| **Скриншот 1** | 3.3.1 | Список активов (AG Grid) |
| **Скриншот 2** | 3.3.1 | Карточка актива |
| **Скриншот 3** | 3.3.2 | Карточка пользователя (закреплённое оборудование) |
| **Скриншот 4** | 3.3.3 | Список заявок |
| **Скриншот 5** | 3.3.3 | Детали заявки с вложениями и активами |
| **Скриншот 6** | 3.3.4 | Смена статуса и назначение исполнителя |
| **Скриншот 7** | 3.3.5 | Поиск и фильтрация |
| **Скриншот 8** | 3.3.6 | Отчёт или экспорт |
| **Скриншот 9** | 3.3.7 | Журнал аудита |
| **Таблица** | 3.3.8 | Примеры входных/выходных данных (импорт, отчёт, запись аудита) |
| **Таблица 2** | 3.4.1–3.4.2 | Результаты тестирования (пройден/не пройден по сценариям) |
| **Демонстрация** | Защита ВКР | По сценариям из 3.3: запуск приложения, разделы Учёт ТС, Заявки, Аудит |

*Документ подготовлен для включения в Главу 3 ВКР. Все указания на вставку скриншотов, листингов, таблиц и демонстрацию работающей программы выполняются автором при подготовке итогового текста и при защите ВКР.*
