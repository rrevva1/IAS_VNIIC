# Карточка актива и карточка пользователя

Краткое описание понятий «карточка актива» и «карточка пользователя» в контексте ТЗ и схемы БД, порядок учёта конфигурации оборудования, а также **текущая практика учёта техники на предприятии** и **размещение данных в БД**.

---

## 1. Как на данный момент ведётся учёт и счёт техники

На предприятии техника учитывается в двух категориях в зависимости от того, присваивается ли ей полноценный инвентарный номер и как она отражается в бухгалтерии.

### 1.1. Активы с полным инвентарным учётом

Отдельно учитываются **с инвентарным номером** (и заводским серийным номером, если есть) следующие типы активов:

- системный блок;
- моноблок;
- ноутбук;
- МФУ (многофункциональное устройство) — на текущий момент; позже перечень может быть расширен (например, серверы, коммутаторы и т.д.).

Для таких активов в БД заводится **одна запись в таблице оборудования** на каждую единицу: инвентарный номер и при наличии серийный номер хранятся в полях актива; тип техники фиксируется (системный блок, моноблок, ноутбук, МФУ).

### 1.2. Активы без инвентарного номера или с пометкой МЦ.04

**МЦ.04** — бухгалтерский термин (малая цена / низкая стоимость). Следующие активы учитываются **без отдельного инвентарного номера** или **с пометкой МЦ.04**:

- мониторы;
- принтеры;
- МФУ до определённой стоимости (порог определяется правилами предприятия);
- ИБП (источники бесперебойного питания);
- возможно, старая техника — перечень может быть уточнён и дополнен позже.

Такая техника в учёте либо не получает уникального инвентарного номера, либо учитывается под маркировкой МЦ.04. В БД эти единицы также целесообразно хранить как отдельные записи оборудования (чтобы вести историю, привязку к пользователю и локации), но с особыми правилами заполнения поля инвентарного номера (см. п. 6).

### 1.3. Идея размещения в БД: пользователь и «собранный» компьютер

Изначальная идея БД: **есть пользователь (сотрудник), и за ним закреплён набор техники**, который в совокупности образует его рабочее место:

- **Ядро:** один основной блок (системный блок, моноблок или ноутбук) — единица с инвентарным номером.
- **Плюс:** монитор (один или несколько), при необходимости — принтер, МФУ, ИБП и т.д. (с инв. номером или МЦ.04 / без инв.).
- Вся эта техника **привязана к одному пользователю** (ответственный) и в интерфейсе/отчётах представляется как **карточка пользователя**: «всё, что закреплено за этим сотрудником».

То есть «компьютер» в смысле рабочего места — это не одна запись в БД, а **набор записей в таблице оборудования** с общим `responsible_user_id` (и, как правило, общей локацией). Карточка пользователя — это **выборка по пользователю**: перечень активов, закреплённых за ним, с возможностью группировки по типу (ПК, монитор, принтер, ИБП и т.д.).

---

## 2. Карточка актива (по ТЗ)

### 2.1. Определение

**Карточка актива** — совокупность сведений об одном активе (одной единице технического средства), хранящихся в Системе (п. 1.3 ТЗ).

### 2.2. Хранение

Одна учётная запись (и связанные с ней записи: история, связи с заявками и т.д.) на **один актив**. То есть карточка актива — данные по одному изделию (один инвентарный номер / один серийный номер или учётная пометка МЦ.04 / без инв.).

### 2.3. Назначение

Учёт актива по полному жизненному циклу:

- регистрация;
- атрибуты (марка, модель, инв. номер, ответственный, локация, статус и т.д.);
- закрепление и снятие за пользователем;
- перемещения, ремонты/ТО, списание;
- связь с заявками;
- архивирование.

Это **объект-центричное** представление: «всё про данный компьютер / монитор / принтер». В ТЗ карточка привязана к **оборудованию**, а не к человеку.

---

## 3. Карточка пользователя (практика предприятия)

На предприятии под «карточками» понимаются **карточки пользователей** — в них отражено закреплённое за пользователем оборудование.

Это **субъект-центричное** представление: «всё, что закреплено за этим сотрудником». Оно не противоречит ТЗ, а дополняет его: те же данные об активах и закреплениях, но сгруппированные по пользователю. В терминах п. 1.3: пользователю «собирается» компьютер (основной блок + монитор + прочая техника), и весь этот набор отображается в карточке пользователя.

---

## 4. Соотношение понятий

| Аспект | Карточка актива (ТЗ) | Карточка пользователя (практика предприятия) |
|--------|----------------------|-----------------------------------------------|
| Единица учёта | Один актив (одна единица ТС) | Один пользователь |
| Содержимое | Все данные по этому активу, история, заявки | Перечень активов, закреплённых за пользователем |
| Хранение в БД | Запись(и) по активу (например, `equipment` + история) | Не отдельная сущность, а выборка/представление по связи «актив — ответственный» |
| Цель | Учёт и жизненный цикл каждого актива | Учёт закрепления техники за сотрудником, контроль «что у кого» |

В ТЗ уже заложена основа для карточки пользователя:

- п. 5.1.5.6 — закрепление актива за пользователем (ответственным);
- п. 5.1.7.3 — получение перечня техники пользователя для отображения в интерфейсе;
- п. 5.1.8.2 — фильтрация активов по закреплению.

Функционально карточка пользователя в ТЗ предусмотрена как перечень техники пользователя и фильтрация по закреплению; термин «карточка пользователя» в документе не введён, что может вызывать путаницу с карточками активов.

---

## 5. Рекомендации по ТЗ

1. **Разделить термины в п. 1.3:**
   - **Карточка актива** — оставить как есть (совокупность сведений об одном активе).
   - **Карточка пользователя** — ввести: «сводное представление по пользователю, содержащее перечень активов (технических средств), закреплённых за данным пользователем, и при необходимости иные регламентированные сведения».

2. **Уточнить в разделе 5.1.5 или 5.1.8:** Система обеспечивает формирование (вывод) карточки пользователя — представления «закреплённое за пользователем оборудование» — в пределах прав доступа. Конкретный состав и формат (экран, отчёт, экспорт) фиксируются на этапе обследования.

3. **При необходимости** в п. 4.1 или в описании контура учёта активов указать одной фразой: учёт ведётся в виде карточек активов (по каждому активу), по пользователям предусматривается представление в виде карточек пользователей (сводка закреплённого оборудования).

---

## 6. Размещение в БД: типы активов и инвентарный номер

### 6.1. Одна запись equipment = один физический актив

В таблице **equipment** хранится **каждая единица техники** отдельной записью: и системный блок, и ноутбук, и монитор, и принтер, и ИБП. Тип задаётся полем **equipment_type** (системный блок, моноблок, ноутбук, МФУ, монитор, принтер, ИБП и т.д.). Связь «кто ответственный» — **responsible_user_id**, «где стоит» — **location_id**. Таким образом, карточка пользователя в БД — это выборка по `responsible_user_id` с группировкой или сортировкой по типу.

### 6.2. Активы с полным инв. номером

Для системного блока, моноблока, ноутбука, МФУ (с полным учётом) в поле **inventory_number** хранится присвоенный инвентарный номер; при наличии — **serial_number**. Ограничение UNIQUE по inventory_number обеспечивает единственность.

### 6.3. Активы без инв. номера или с пометкой МЦ.04

В текущей схеме поле **inventory_number** объявлено как NOT NULL. Варианты отражения техники «без инвентарного номера» или «МЦ.04»:

| Подход | Описание | Плюсы / минусы |
|--------|----------|-----------------|
| **А. Синтетический номер** | Для каждой такой единицы присваивать уникальный идентификатор, например «МЦ.04-103-001» (локация + порядковый) или «Б/Н-&lt;id&gt;». В БД хранить в inventory_number. | Не требует изменения схемы; всегда есть уникальный ключ. Нужен регламент формирования. |
| **Б. Разрешить NULL** | Сделать **inventory_number** допускающим NULL. Записи без инв. номера или с учётной пометкой МЦ.04 — без значения или с пометкой в отдельном поле/справочнике. | Честно отражает «нет инв. номера». Требует изменения DDL и проверок в коде (UNIQUE не сработает для NULL в части СУБД — несколько NULL допустимы). |
| **В. Справочник учётных категорий** | Ввести справочник (например, dic_accounting_category: «полный инв. учёт», «МЦ.04», «без инв.») и поле equipment.accounting_category_id. Инв. номер для МЦ.04 — опционально или по регламенту. | Явное разделение по правилам учёта; отчёты и фильтры по категории. Требует расширения схемы. |

**Рекомендация:** на первом этапе использовать **подход А** (синтетический уникальный номер для МЦ.04/без инв.), чтобы не менять ограничение NOT NULL и не усложнять выборки. При необходимости позже ввести справочник учётной категории (подход В) и при желании — разрешить NULL (подход Б) по решению заказчика.

### 6.4. Карточка пользователя в БД

- **Хранение:** отдельной таблицы «карточка пользователя» нет. Данные формируются выборкой: все записи **equipment**, у которых **responsible_user_id** = данный пользователь (и при необходимости is_deleted = false, is_archived = false).
- **Представление:** в интерфейсе или отчёте — список/группировка по equipment_type (сначала основной блок — системный блок/моноблок/ноутбук, затем монитор, принтер, ИБП и т.д.). При необходимости можно вывести «ядро АРМ» (один ПК + монитор(ы)) и «прочее оборудование» по бизнес-правилам (например, по типу или по связи с основным блоком, если позже будет введена связь «актив привязан к другому активу»).

---

## 7. Учёт конфигурации и инвентарного номера (схема БД)

Конфигурация компьютера формируется из справочников (составная часть + тип характеристики + значение). Инвентарный номер (или учётная пометка МЦ.04/синтетический номер) хранится в записи оборудования. Ниже — как в такой модели ведётся учёт.

### 7.1. Единица учёта и инв. номер

В схеме БД **единица учёта = одна запись в таблице `equipment`** (системный блок, ноутбук, моноблок, монитор, принтер, ИБП и т.п.). Инв. номер хранится в поле `inventory_number` (в целевой схеме); для активов МЦ.04 или без инв. — по правилам п. 6.3.

**Итог:** одна строка `equipment` = один актив (одна физическая единица техники); у активов с полным учётом — уникальный инв. номер.

### 7.2. Конфигурация в текущей схеме БД

Конфигурация **не** заводится как отдельные активы на процессор, диск, ОЗУ. Она хранится как **набор характеристик одного актива** в таблице `part_char_values`:

| Таблица | Назначение |
|---------|------------|
| **spr_parts** | Справочник типов составных частей: Процессор, ОЗУ, Жесткий диск, Монитор и т.д. |
| **spr_chars** | Справочник типов характеристик: Модель, Производитель, Тип памяти, Объём (ГБ), Тип накопителя и т.д. |
| **part_char_values** | Для каждого `equipment_id` (системного блока): связка (part_id, char_id) + значение. |

**Пример** для одного системного блока (id_arm 103):

- (103, Процессор, Производитель) → Intel  
- (103, Процессор, Модель) → I5-12500  
- (103, ОЗУ, Тип памяти) → DDR4  
- (103, ОЗУ, объём) → 16  
- (103, Жесткий диск, объём) → 1024  
- (103, Жесткий диск, Тип накопителя) → SSD, NVMe  

**Итог:** учёт ведётся по одному активу (`equipment`); конфигурация — множество строк в `part_char_values` с тем же `equipment_id`, каждая строка — «составная часть + характеристика + значение».

### 7.3. Значение: текст или справочник

В текущей схеме значение хранится как **текст** в `part_char_values.value_text`. Отдельного справочника допустимых значений (i9 14600, SSD, 32 GB) в БД нет.

**Вариант А (как сейчас):** составная часть и тип характеристики задаются справочниками `spr_parts` и `spr_chars`, конкретное значение — произвольная строка в `value_text`. Список подсказок (i9 14600, SSD, 32 GB) может быть в интерфейсе или в конфиге.

**Вариант Б (справочник значений):** ввести таблицу допустимых значений по парам (тип части, тип характеристики), например `spr_char_value_options` с полями `part_id`, `char_id`, `value_text` (и при необходимости `value_code`, `sort_order`). В `part_char_values` добавить необязательный FK на эту таблицу (`value_id`), поле `value_text` оставить для произвольного ввода. Тогда конфигурация собирается как: составная часть (spr_parts) + характеристика (spr_chars) + значение из справочника или ввод вручную.

### 7.4. Краткий итог по учёту

- **Учёт по активу:** одна запись в `equipment` = одна физическая единица техники (системный блок, моноблок, ноутбук, МФУ, монитор, принтер, ИБП и т.д.); инв. номер или учётная пометка (МЦ.04/синтетический) — в `inventory_number` по правилам п. 6.
- **Учёт конфигурации:** по этому же `equipment_id` в `part_char_values` хранятся строки «составная часть + характеристика + значение» (для ПК — процессор, ОЗУ, диск, монитор и т.д.).
- **Составная часть** задаётся справочником `spr_parts` (процессор, накопитель, ОЗУ и т.д.).
- **Тип характеристики** задаётся справочником `spr_chars` (модель, объём, тип памяти и т.д.).
- **Значение** в текущей схеме — текст в `value_text`; при необходимости может быть ограничено справочником допустимых значений (отдельная таблица и ссылка из `part_char_values`).
- **Карточка пользователя** — выборка по `equipment.responsible_user_id` с группировкой по типу техники; отдельной таблицы не требуется.

Состав конфигурации (обязательные и дополнительные атрибуты, справочники типов частей и характеристик, при необходимости — справочник допустимых значений) уточняется на этапе обследования и фиксируется в проектной документации.
